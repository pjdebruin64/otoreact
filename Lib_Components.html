<module id="Lib_Components.html">
    <!-- This component ensures that all <a> elements with no target and an external href, get a target='_blank' attribute -->
    <component>
        <a href? #target? ...rest>
            <contents></contents>
        </a>
        <template><a. #href="href"
            #target="!target && /^http/i.test(href) ? '_blank' : target"
            #style.fontWeight="href == (docLocation.subpath || '.') || href==location.hash ? 'bold' : null"
            #onclick="/^(https?:|#)/i.test(href) ? null : reroute"
            ...rest
            ><contents></contents></a.
        ></template>
    </component>


    <component>
        <RHTML #srctext></RHTML>
        <template>
            <RHTML srctext="<style>button,input \{font-size: 90%}</style>{srctext}"></RHTML>
        </template>
    </component>

        
    <!-- Component to demonstrate RHTML -->
    <component>
        <demo #srctext?="''" #bshow=true #editable=true rvar?></demo>
        <!-- Beware: any braces in the content attribute must be prefixed with a '\' -->

        <style>
            table.demo   { 
                margin: 2ex auto; 
                max-width:100%;
            }
            table.demo > tr > th, table.demo > tr > td {
                border: var(--RedBorder);
                vertical-align: top;
                min-width:320px;
                max-width:700px;
            }
            table.demo > tr > th, table.demo > tr > td { padding: 8px; }

            table.demo > tr > *:nth-child(1) {
                background-color: rgb(245, 245, 245);
            }
            table.demo > tr > td:nth-child(1) > pre { 
                color: darkblue;
                white-space: pre-wrap;
                font-size: 80%;
                min-height: 4em;
                margin: 0px;
            }
            span.demoGreen  { color: green; } /* This is for comments */
            span.mTag       { color: blue; }
            span.otored     { color: var(--OtoRed); }

            pre.nodisplay {display: none }

            table.demo td.demo {
                background-color: rgb(225, 255, 181);
            }
            @media screen and (hover: none) {
                td.demo {
                    _font-size: 14pt;
                }
            }
        </style>
        
        <template #srctext=source>
            <define var=srctext #value="rvar || RVAR('', source.trim())"></define>
            <define rvar=rShow  #value="bshow"></define>
            <table. class=demo>
                <tr.><th.>
                    <button onclick="rShow.V=!rShow.V" reacton=rShow>{rShow.V ? 'Hide' : 'Show'}</button>
                    <if cond=editable>Editable</if> Source Code
                </th.><th.><if cond=editable>Live</if> Result</th.></tr.>
                <tr.>
                    <td.>
                        <pre #class:nodisplay="!rShow.V" reactOn=rShow
                            #contenteditable="editable.toString()" spellcheck=false 
                            #innerHTML="ColorCode(srctext.V)" 
                            !innerText="srctext.V"></pre>
                    </td.>
                    <td. class=demo>           
                        <RHTML reacton=srctext #srctext="srctext.V"></RHTML>
                    </td.>
                </tr.>
            </table.>
        </template>
    </component>


    <!-- This component defines our page layout -->
    <component>
        <pageLayout>
            <pageHead></pageHead>
            <leftbar></leftbar>
            <contents>
                <!-- Within the page contents, h1-h3 are redefined to add the header texts tot the table of contents -->
                <h1 id?><contents></contents></h1>
                <h2 id?><contents></contents></h2>
                <h3 id?><contents></contents></h3>
            </contents>
        </pageLayout>

        <style>
            body    {
                margin: 0px;
            }
            div.pageLayout {
                display:  grid;
                gap: 4px;
                margin: 4px auto;
            }
            div.pageLayout > *{
                box-shadow:0 0 0 4px lightgray;
                padding: 8px 4px;
                _scrollbar-width: 3vw;
            }
            div.pageLayout > header    { 
                grid-row: 1;
                display: grid; 
                grid-template-columns: 1fr auto auto; 
                grid-template-areas:
                "title credits logo"
                "nav   built   logo";
                align-items: stretch;
                padding: 8px;
            }
            div.pageLayout > nav {
                grid-row: 2;
            }
            
            div.pageLayout > nav > nav {
                column-width: 15em;
                line-height: 1.25;
            }
            div.pageLayout > nav, .nav {
                font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
                font-size: 87.5%;
            }
            div.pageLayout > nav  a,
            div.pageLayout > nav  details,
            div.pageLayout > nav  details > a {
                display: block;
                border: none;
                padding-left: 1ex;
                text-indent: -1ex;
            }
            div.pageLayout > nav  a:not(.chapter) {
                padding-left: 1ex;
            }
            div.pageLayout > nav  a.chapter {
                margin-top: 1.5ex; margin-bottom: .75ex;
                font-weight: bold;
            }
            div.pageLayout > main { 
                grid-row: 3;
            }

            @media screen and (max-width: 1200px) {
                div.pageLayout > nav {
                    max-height: 75vh;
                    overflow-y: auto;
                }
                div.pageLayout > nav > div {
                    column-count: 2;
                }
            }
            
            @media screen and (min-width: 1200px) {
                div.pageLayout  {
                    grid-template-columns: 16em 1fr;
                    grid-template-rows: min-content 1fr;
                    max-height: calc(100vh - 8px);
                    min-width: 900px;
                    max-width: 1430px;
                }
                div.pageLayout > *{
                    padding: 8px 8px;
                }
                div.pageLayout > header    { 
                    grid-column: 1/3; 
                }
                div.pageLayout > nav    {
                    grid-area: 2 / 1;
                    columns: unset;
                    overflow-y: auto;
                    height: auto;
                }
                div.pageLayout > main { 
                    grid-area: 2 / 2; 
                    overflow-y: auto;
                    height: auto;
                }
                body {
                    overflow-y: hidden;
                }
                .narrow-only { display: none; }
            }

            nav.topbar {
                display: flex;
                padding: 1px 41px
            }
            nav.topbar > * {
                padding: 6px 12px;
                text-align: center;
                min-width: 100px;
                border: solid var(--OtoRed) 2px;
                background-color: rgb(233, 233, 233);
                margin: -1px;
            }
            @media print {
                nav.topbar, .narrow-only {display: none}
            }
        </style>
        <def rvar="num" #value="0"></def>

        <template>
            <script type="otoreact/local" defines="pNum, contents, getNr, addContent">
                let pNum = ++num.V,
                    numbers = [0,0,0],
                    contents = RVAR(null, []);
                    
                function getNr(level) {
                    numbers[level]++;
                    numbers[level+1] = 0;
                    let result = '';
                    for (let i=0; i<=level; i++)
                        if (result||numbers[i])
                            result += `.${numbers[i]}`;
                    return result.substring(1);
                }
                let lastDetails;
                function addContent(level, headElm) {
                    let entry = {level, id: headElm.id, text: headElm.textContent, subs: [] };
                    if (level == 1) lastDetails = entry.subs;
                    (level <= 9 ? contents.U : lastDetails).push(entry);
                }
            </script>
            <div class=pageLayout>
                <header>
                        <div style="padding-left: 40px">
                            <p style="font-size: 28pt; font-weight: bold; padding-bottom: .5ex;">
                                <pageHead></pageHead>
                            </p>
                        </div>
                        <div style='text-align: right; align-self: start; padding-right: 1ex; font-size:90%; white-space: nowrap;'>
                            Created by <a 
                                onclick="
                                    let rect = this.getBoundingClientRect();
                                    popup.V={display: null, left: `${window.scrollX + rect.left - 250}px`, top: `${window.scrollY + rect.top + 30}px`};
                                    event.stopPropagation();" 
                                title="More about me">Peter J. de Bruin</a>.
                                <p>Made possible by:</p>
                                <p #if="!ga">Nontracked</p>
                        </div>
                        <div style="grid-area: built; align-self: end; text-align: right; padding-right: 1ex; font-size:90%; white-space: nowrap;">
                            <p>Built with <a href="./" class=OtoRed style.textDecoration=none>OtoReact</a></p>
                        </div>
                        <div style="grid-area: logo;">
                            <a href="https://www.otolift.com">
                                <img src="KoninklijkeOtolift.png" style="height:125px; object-fit:contain"
                                    alt="Otolift Stairlifts" title="Otolift Stairlifts,{'\n'}The Netherlands"
                                >
                            </a>
                        </div>
                        <nav class=topbar style="grid-area: nav;" reacton=docLocation>
                            <a href="."         #onclick=reroute>Home</a>
                            <a href="components" #onclick=reroute #if="!ga">Components</a>
                            <a href="routing"   #onclick=reroute>Routing</a>
                            <a href="otolib"    #onclick=reroute>OtoLib</a>
                            <a href="download"  #onclick=reroute>Download</a>                        
                            <a href="https://forum.otoreact.dev/">Forum</a>
                        </nav>
                </header>
                <main style.position="relative">
                    <button class="nav narrow-only"
                        style="position: fixed; bottom: 8pt; right: 8pt; background-color: orange; z-index:1;"
                        onclick="reroute('#TOC'); this.parentElement.nextElementSibling.scrollIntoView()"
                        >↑ Contents ↑</button>
                    <!-- Here the contents of the page definition will be inserted -->
                    <contents>
                        <!-- Inside the contents, the following construsts are available: -->
                        <h1 id>
                            <def var=nr #value="getNr(0)"></def>
                            <h1. #id="id||`s${pNum}.${nr}`" onCreate="addContent(0, this)">{nr}. &nbsp;<contents></contents></h1.>
                        </h1>
                        <h2 id>
                            <def var=nr #value="getNr(1)"></def>
                            <h2. #id="id||`s${pNum}.${nr}`" onCreate="addContent(1, this)">{nr} &nbsp;<contents></contents></h2.>
                        </h2>
                        <h3 id>
                            <def var=nr #value="getNr(2)"></def>
                            <h3. #id="id||`s${pNum}.${nr}`" onCreate="addContent(2, this)">{nr} &nbsp;<contents></contents></h3.>
                        </h3>
                    </contents>
                </main>
                <nav id=TOC>
                    <nav>
                    <component><entry #item></entry>
                        <template>
                            <a. #class:chapter="item.level == 0"
                                href="#{item.id}">
                                {item.text}
                            </a.>
                        </template>
                    </component>
                    <center style="background-color: orange;">
                        <b><i>Table of Contents</i></b>
                    </center>
                    <for let=item of=contents.V reacton="contents,docLocation" key="item">
                        <if cond="item.subs.length">
                            <then>
                                <details>
                                    <summary><entry #item="item"></entry></summary>
                                    <for let="sub" of="item.subs">
                                        <entry #item="sub"></entry>
                                    </for>
                                </details>
                            </then>
                            <else>
                                <entry #item="item"></entry>
                            </else>
                        </if>
                    </for>
                    
                    <leftbar></leftbar>
                </nav></nav>
            </div>
        </template>
    </component>
</module>