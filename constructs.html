
<h2>RHTML Construct details</h2>

N.B. All construct attributes which must be JavaScript expressions, like <code>value</code>, <code>cond</code>, and <code>of</code>, may be prefixed with a hash mark: <code>#value</code>, <code>#cond</code>, <code>#of</code>.
<br>Their meaning remains the same.

<h3 id=define>&lt;DEFINE var value react?&gt;, local variables</h3>
<pre>
<elm>DEFINE var=<i>name</i> value="<i>expression</i>"</elm><elm>/DEFINE</elm>
</pre>
<p>
    introduces a local <u>immutable</u> variable <code><i>name</i></code>, with a value computed by <code><i>expression</i></code>.
    <br>The variable is visible in all local expressions from the <elm>/DEFINE</elm> till the end of the enclosing element, except when obscured by nested definitions.
    <br>It cannot be assigned to, but when its value is an RVAR or some other object, then one can of course modify its properties.
</p>
<p>
    The expression is, by default, evaluated only once, when the respective DOM-trunk is built, not when it is updated.
    <br>When you add an attribute <code>react</code> (without value), then the expression is re-evaluated at every update.
</p>
<pre><elm>DEFINE rvar=<i>name</i> value="<i>expression</i>"</elm><elm>/DEFINE</elm></pre>
<p>
    introduces a local <u>reactive</u> variable <code><i>name</i></code>, with a value computed by <code><i>expression</i></code>.
    <br>This is equivalent to <code><elm>DEFINE var=<i>name</i> value="RVAR(null, <i>expression</i>)"</elm><elm>/DEFINE</elm></code>.
</p>
<p>
    <elm>DEFINE</elm> may be abbreviated to <elm>DEF</elm>.
</p>
<p>
    Local variable names (including loop variables and component parameters) obey strict <a href="{wikipedia}Scope_(computer_science)#Lexical_scope">lexical scoping</a> rules:
</p>
<demo content=
"<def var=a value=&quot;10&quot;></def>
<def var=f value=&quot;(x) => a+x&quot;></def>

<p> \{a}, \{f(1)} </p>

<p>
    <def var=a value=20></def>
    \{a}, \{f(2)}
</p>

<p> \{a} </p>"
></demo>

<h3>&lt;IF cond&gt; &lt;ELSE&gt;</h3>
<pre><elm>IF cond="<i>expr</i>"</elm> 
    <i>ThenPart</i> 
    &lt;ELSE&gt; <i>ElsePart</i> &lt;/ELSE&gt;
&lt;/IF&gt;
</pre> is a conditional trunk of RHTML.
<ul>
    <li>
        <code><i>ThenPart</i></code> may be any piece of RHTML, which is included in the document IF the value of <code><i>expr</i></code> is true (or <a href="{MDN}Glossary/Truthy">truthy</a>).
    </li>
    <li>
        ELSE, when there is an <elm>ELSE</elm> part (the question mark indicates it is optional), then <code><i>ElsePart</i></code> is included. 
    </li>
</ul>

<h3>&lt;CASE&gt; &lt;WHEN cond&gt; &lt;ELSE&gt;</h3>
<pre>
&lt;CASE&gt;
    <elm>WHEN cond="<i>expr</i>"</elm> <i>WhenPart</i> &lt;/WHEN&gt;
    &hellip;
    &lt;ELSE?&gt; <i>ElsePart</i> &lt;/ELSE&gt;
&lt;/CASE&gt;
</pre>
<ul>
    <li>
        There may be multiple <elm>WHEN</elm> parts.
    </li>
    <li>
        The first <i>WhenPart</i> for which the value of <i>expr</i> is truthy, is included in the document.
    </li>
    <li>
        If none is, and there is an <elm>ELSE</elm> part, then <i>ElsePart</i> is included.
    </li>
</ul>

<h3>&lt;FOR let of index? key? hash?&gt;</h3>
<demo #content="sampleParticipants">
</demo>

<h3>&lt;COMPONENT&gt;</h3>
<demo #content=sampleTODO>
</demo>

<p>Components may be recursive, i.e. refer to themselve.
<br>Here is a recursive component, imaging nested lists of lists:</p>
<demo #bShow=false #content=sampleRecursion></demo>

<p>Components may redefine HTML constructs. To refer to the original construct, add a dot to the tag name.
<br>Here is a component that redefines <elm>a</elm> to ensures that all links with no target and an external href, get a <code>target='_blank'</code> attribute:</p>
<demo content="<component>
    <a href #target? download? title?><content></content></a>
    <template><a. #href=&quot;href&quot; #download=&quot;download&quot; #title=&quot;title&quot;
        #target=&quot;!target && /^http/i.test(href) ? '_blank' : target&quot;
        ><content></content></a.
    ></template>
</component>

This link opens in a blank window:
<a href=&quot;https://www.otolift.com/&quot;>Otolift Stairlifts</a>">
</demo>


<h3>&lt;REACT on&gt;, reacton</h3>
<div id=TicTacToe></div>
<demo #bShow=false #content=sampleTicTacToe></demo>


<h3>&lt;FOR #of&gt; over component slots</h3>
Here is a component which allows one to define tables column by column.
<demo #bShow=false #content=sampleTableMaker></demo>

<h3>&lt;INCLUDE src&gt;</h3>
<elm>INCLUDE src="&hellip;"</elm> allows you to include another RHTML file as if it were inserted into the main file.
<br>The file is fetched, compiled and build <i>asynchronously</i>: compiling the main file will continue while the file is being fetched.
<p>
    You can insert code to be shown till the including is fulfilled.
</p>

<h3>&lt;IMPORT src&gt;</h3>

<h3>&lt;RHTML&gt;</h3>

<h3>&lt;DOCUMENT&gt;</h3>