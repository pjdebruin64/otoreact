<head>
  <script type=module>
    import { RCompile } from './OtoReact.js';
    RCompile( document.body );
  </script>
</head>
<body>
  <script nomodule 
  defines="ColorTable,toHex,handle,StartStop,bAnimate" >
// Here we store the data. Columns are:
// name:string, red:number, green:number, blue:number.
const ColorTable = RVAR( null,
  /* Fetch the data! */
  RFetch("webColors.json").then(response => response.json())
);
/* Too bad JavaScript has no async blocks, like:
  async { ... await ... return await ... }
*/

/* Utility for 2-digit hex code */
function toHex(n){ 
  return n.toString(16).toUpperCase().padStart(2,'0');
}

/* Rotation */
let handle=RVAR(), bAnimate=RVAR();

function StartStop() {
  if (handle.V) {
    clearInterval(handle.V); handle.V=0;
  } else
    handle.V = setInterval(() => {
      // Modify the data model, triggering a DOM update:
      ColorTable.U.push(ColorTable.V.shift());
    }, 330);
  bAnimate.V = true;
}
</script>

<!-- Styling -->
<style>
  table.colorTable td {
    padding: 0px 4px;
    text-align: center;
    max-width: 8em; overflow:hidden;
  }

  @keyframes Disappearing {
    from {line-height: 100%}
    to   {line-height: 0%}
  }
  
  tbody.animated > tr:first-child {
    animation: Disappearing 300ms linear 30ms forwards
  }
</style>

<div style="height:50ex; overflow-y:scroll;">
<!-- Now we build our table! 
The dots are needed because HTML does not allow <FOR> as a
child of <TABLE>. OtoReact removes these dots. -->
<table. class=colorTable>

  <!-- Table caption -->
  <caption.>Web Colors 
    <button onclick="StartStop();" reacton=handle
        style="float:right; width:5em">
        {handle.V ? 'Stop' : 'Rotate'}
    </button>
  </caption.>

  <!-- Column headers -->
  <tr.>
    <th.>Name</th.>
    <th.>R</th.> <th.>G</th.> <th.>B</th.>
    <th.>Hex</th.>
  </tr.>

  <tbody. #class:animated="bAnimate.V" thisreactson=bAnimate>
    <!-- Detail records -->
    <FOR let=C of="ColorTable.V" hash=C reacton=ColorTable>
      <tr. 
        style.backgroundColor="rgb({C.red},{C.green},{C.blue})" 
        #style.color = "C.green<148 ? 'white' : 'black'"
      >
        <td.>{C.name}</td.>
        <td.>{C.red}</td.>
        <td.>{C.green}</td.>
        <td.>{C.blue}</td.>
        <td.>
          #{toHex(C.red)}{toHex(C.green)}{toHex(C.blue)}
        </td.>
      </tr.>
    </FOR>
  </tbody.>
</table.>
</div>
</body>